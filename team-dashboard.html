<!DOCTYPE html>
<html>
<head>
  <title>VT Team Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    *{ box-sizing:border-box; margin:0; padding:0; font-family:'Montserrat',sans-serif; }
    body{ display:flex; flex-direction:row; min-height:100vh; background:#e0f0ff; }
    .sidebar{ width:220px; background:linear-gradient(180deg,#0072ff,#00c6ff); color:#fff; padding:30px 20px; display:flex; flex-direction:column; min-height:100vh; align-items:flex-start; }
    .profile{text-align:center;margin-bottom:30px;}
    .profile img{width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid #fff;margin-bottom:10px;}
    .profile h3{font-size:18px;margin-bottom:5px;color:#fff;}
    .profile p{font-size:14px;color:#f0f0f0;}
    .sidebar button{background:transparent;color:#fff;border:none;width:100%;text-align:left;padding:12px 10px;margin-bottom:10px;border-radius:8px;cursor:pointer;transition:background 0.3s;font-weight:600;}
    .sidebar button:hover{background:rgba(255,255,255,0.2);}
    .main{flex:1;padding:30px;display:flex;flex-direction:column;overflow-y:auto;}
    h2{margin-bottom:20px;color:#0072ff;}
    h3{margin:20px 0 10px;}
    .summary{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:30px;}
    .summary-card{flex:1 1 150px;background:#fff;border-radius:12px;padding:15px 20px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
    .summary-card p{font-weight:600;color:#555;}
    .summary-card h3{font-size:22px;margin-top:5px;color:#0072ff;}
    .progress-bar{background: rgba(0,0,0,0.05);border-radius:12px;height:15px;margin-top:10px;overflow:hidden;}
    .progress-fill{background: linear-gradient(90deg,#0072ff,#00c6ff);height:100%;width:0%;transition: width 0.5s ease;border-radius:12px;}
    .task-card{background:#fff;border-radius:12px;padding:20px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:flex-start;box-shadow:0 4px 12px rgba(0,0,0,0.1);transition:transform 0.2s, box-shadow 0.2s;flex-wrap:wrap;}
    .task-card:hover{transform:translateY(-3px);box-shadow:0 6px 16px rgba(0,0,0,0.15);}
    .task-info p{margin-bottom:6px;color:#333;}
    .badge{font-weight:600;padding:3px 10px;border-radius:12px;color:#fff;font-size:12px;}
    .task-actions button{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;background: linear-gradient(90deg,#0072ff,#00c6ff);color:#fff;font-weight:600;transition: background 0.3s;}
    .task-actions button:hover{background: linear-gradient(90deg,#005fcc,#00bfff);}
    .charts{display:flex;flex-wrap:wrap;gap:30px;margin-bottom:30px;}
    .chart-container{background:#fff;border-radius:12px;padding:20px;flex:1;min-width:250px;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
    @media(max-width:900px){ .summary,.charts{flex-direction:column;} .task-card{flex-direction:column;align-items:flex-start;} .task-actions{margin-top:10px;} }
  </style>
</head>
<body>

<div class="sidebar">
  <div class="profile">
    <img id="profilePic" src="" alt="Profile">
    <h3 id="profileName">Hello!</h3>
    <p id="profileRole"></p>
  </div>
  <button onclick="goDashboard()">Home</button>
  <button onclick="goTeamDashboard()">Team Dashboard</button>
  <button onclick="viewMyTasks()">Go to My Tasks</button>
  <button onclick="logout()">Logout</button>
</div>

<div class="main">
  <h2 id="greeting">Hello!</h2>

  <div class="summary">
    <div class="summary-card"><p>Total Tasks</p><h3 id="totalTasks">0</h3></div>
    <div class="summary-card"><p>Completed</p><h3 id="completedTasks">0</h3></div>
    <div class="summary-card"><p>Pending</p><h3 id="pendingTasks">0</h3></div>
    <div class="summary-card">
      <p>Progress</p>
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
    </div>
  </div>

  <div class="charts">
    <div class="chart-container"><canvas id="tasksPerMember"></canvas></div>
    <div class="chart-container"><canvas id="statusDistribution"></canvas></div>
  </div>

  <div id="allTasks"></div>
</div>

<script>
let loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
const members = ["dominic","anne","mary"];
const statusColors = { "Assigned":"#1976D2","Submitted":"#FBC02D","Done":"#388E3C","Overdue":"#D32F2F" };
const priorityColors = { "High":"#D32F2F","Medium":"#F57C00","Low":"#388E3C" };

/* Personalized UI */
if(!loggedUser){
  alert("No user logged in");
  window.location.href="index.html";
} else {
  document.getElementById("profileName").innerText = "Hello, " + loggedUser.name;
  document.getElementById("profileRole").innerText = loggedUser.role;
  document.getElementById("profilePic").src = loggedUser.pic || "images/denis.jpg";
  document.getElementById("greeting").innerText = `Welcome, ${loggedUser.name}!`;
}

/* Navigation */
function goDashboard(){ alert("You are on the dashboard"); }
function goTeamDashboard(){}
function viewMyTasks(){
  if(loggedUser && loggedUser.page){
    window.location.href = loggedUser.page; // redirects to mary.html, dominic.html, etc.
  } else {
    alert("Cannot find your personal page");
  }
}
function logout(){ localStorage.removeItem("loggedInUser"); window.location.href="index.html"; }

/* Load Dashboard */
function loadDashboard(){
  let tasksToShow = (loggedUser.name==="Denis") ? tasks : tasks.filter(t => t.person.toLowerCase() === loggedUser.name.toLowerCase());

  const total = tasksToShow.length;
  const completed = tasksToShow.filter(t=>t.status==="Done").length;
  const pending = total-completed;
  const progressPercent = total===0?0:Math.round((completed/total)*100);

  document.getElementById("totalTasks").innerText = total;
  document.getElementById("completedTasks").innerText = completed;
  document.getElementById("pendingTasks").innerText = pending;
  document.getElementById("progressFill").style.width = progressPercent+"%";

  const allTasksDiv = document.getElementById("allTasks");
  allTasksDiv.innerHTML = "";
  const today = new Date().toISOString().split("T")[0];

  tasksToShow.forEach((t,index)=>{
    let status = t.status;
    if(t.status!=="Done" && t.deadline && t.deadline<today) status="Overdue";

    allTasksDiv.innerHTML += `
      <div class="task-card">
        <div class="task-info">
          <p><strong>${t.title}</strong></p>
          <p>Assigned to: ${t.person}</p>
          <p>Deadline: ${t.deadline || "N/A"}</p>
          <p>Priority: <span class="badge" style="background:${priorityColors[t.priority] || "#0072ff"}">${t.priority || "Medium"}</span></p>
          <p>Status: <span class="badge" style="background:${statusColors[status]}">${status}</span></p>
          <p>Submission: ${t.submission || "Not submitted"}</p>
        </div>
        <div class="task-actions">
          ${t.status!=="Done"?`<button onclick="markDone(${index})">Mark Done</button>`:""}
        </div>
      </div>
    `;
  });

  loadCharts();
}

/* Mark Done */
function markDone(index){
  tasks[index].status="Done";
  localStorage.setItem("tasks", JSON.stringify(tasks));
  loadDashboard();
}

/* Charts */
let tasksChart,statusChart;
function loadCharts(){
  const memberCounts = members.map(m=>tasks.filter(t=>t.person.toLowerCase()===m).length);
  if(tasksChart) tasksChart.destroy();
  tasksChart = new Chart(document.getElementById("tasksPerMember"), {
    type:'bar',
    data:{ labels:members.map(m=>m.charAt(0).toUpperCase()+m.slice(1)), datasets:[{ label:'Tasks Assigned', data:memberCounts, backgroundColor:['#1976D2','#00bfff','#4CAF50'] }] },
    options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });

  const statusTypes = ["Assigned","Submitted","Done","Overdue"];
  const statusCounts = statusTypes.map(s=>tasks.filter(t=>t.status===s).length);
  if(statusChart) statusChart.destroy();
  statusChart = new Chart(document.getElementById("statusDistribution"), {
    type:'pie',
    data:{ labels:statusTypes, datasets:[{ data:statusCounts, backgroundColor:['#1976D2','#FBC02D','#388E3C','#D32F2F'] }] },
    options:{ responsive:true }
  });
}

loadDashboard();
</script>

</body>
</html>
